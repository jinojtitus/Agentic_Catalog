%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#2E86AB', 'primaryTextColor': '#fff', 'primaryBorderColor': '#1E5F8E', 'lineColor': '#5C677D', 'secondaryColor': '#A23B72', 'tertiaryColor': '#F18F01', 'background': '#C73E1D'}}}%%
flowchart TB
    %% Intake - Blue
    subgraph INTAKE["INTAKE"]
        direction TB
        I1[Currency Order Request]
        I2[Branch Currency Request]
        I3[ATM Replenishment Request]
        I4[Commercial Client Order]
        I1 --> I2
        I2 --> I3
        I3 --> I4
    end
    
    %% Triage - Purple
    subgraph TRIAGE["TRIAGE"]
        direction TB
        T1[Validate Request]
        T2[Check Inventory Levels]
        T3[Priority Assessment]
        T4[Route to Processing]
        T1 --> T2
        T2 --> T3
        T3 --> T4
    end
    
    %% Fulfilment - Green
    subgraph FULFILMENT["FULFILMENT"]
        direction TB
        F1[Currency Preparation]
        F2[Quality Check]
        F3[Package for Delivery]
        F4[Schedule Transport]
        F5[Delivery Confirmation]
        F1 --> F2
        F2 --> F3
        F3 --> F4
        F4 --> F5
    end
    
    %% Investigations - Orange
    subgraph INVESTIGATIONS["INVESTIGATIONS"]
        direction TB
        IV1[Counterfeit Detection]
        IV2[Shortage Investigation]
        IV3[Damaged Currency Review]
        IV4[Discrepancy Resolution]
        IV1 --> IV2
        IV2 --> IV3
        IV3 --> IV4
    end
    
    %% Escalations - Red
    subgraph ESCALATIONS["ESCALATIONS"]
        direction TB
        E1[Critical Shortage Alert]
        E2[Security Incident]
        E3[Regulatory Reporting]
        E4[Senior Management Review]
        E1 --> E2
        E2 --> E3
        E3 --> E4
    end
    
    %% Risk Controls - Dark Blue
    subgraph RISK["RISK CONTROLS"]
        direction TB
        R1[Dual Control Verification]
        R2[Transport Security Check]
        R3[Insurance Validation]
        R4[Compliance Review]
        R5[Audit Trail]
        R1 --> R2
        R2 --> R3
        R3 --> R4
        R4 --> R5
    end
    
    %% Support Operations - Teal
    subgraph SUPPORT_OPS["SUPPORT - OPERATIONS MANAGEMENT"]
        direction TB
        SO1[Inventory Management]
        SO2[Vendor Coordination]
        SO3[Equipment Maintenance]
        SO4[Staff Scheduling]
        SO1 --> SO2
        SO2 --> SO3
        SO3 --> SO4
    end
    
    %% Support Process - Gray
    subgraph SUPPORT_PROC["SUPPORT - PROCESS MANAGEMENT"]
        direction TB
        SP1[Process Documentation]
        SP2[Performance Metrics]
        SP3[Training Programs]
        SP4[Continuous Improvement]
        SP1 --> SP2
        SP2 --> SP3
        SP3 --> SP4
    end
    
    %% Main Flow Connections
    I4 --> T1
    T4 --> F1
    F5 --> Complete[Currency Delivered]
    
    %% Investigation Triggers
    F2 -.->|Quality Issues| IV1
    F1 -.->|Shortage Detected| IV2
    
    %% Escalation Triggers
    IV4 -.->|Major Discrepancy| E1
    T2 -.->|Critical Shortage| E1
    
    %% Risk Control Integration
    F1 -.->|Verification| R1
    F4 -.->|Security| R2
    
    %% Support Integration
    T2 -.->|Inventory Check| SO1
    F4 -.->|Transport| SO2
    
    %% Process Support
    Complete -.->|Metrics| SP2
    E4 -.->|Process Review| SP4
    
    %% Outcome Paths
    E4 --> Hold[Hold Order]
    IV4 --> Resolve[Issue Resolved]
    R5 --> Approved[Approved for Release]
    
    %% Styling
    classDef intakeStyle fill:#2E86AB,stroke:#1E5F8E,stroke-width:2px,color:#fff
    classDef triageStyle fill:#A23B72,stroke:#7D2E5A,stroke-width:2px,color:#fff
    classDef fulfilmentStyle fill:#27AE60,stroke:#1E8449,stroke-width:2px,color:#fff
    classDef investigationStyle fill:#F18F01,stroke:#C73E1D,stroke-width:2px,color:#fff
    classDef escalationStyle fill:#E74C3C,stroke:#C0392B,stroke-width:2px,color:#fff
    classDef riskStyle fill:#34495E,stroke:#2C3E50,stroke-width:2px,color:#fff
    classDef supportOpsStyle fill:#16A085,stroke:#138D75,stroke-width:2px,color:#fff
    classDef supportProcStyle fill:#7F8C8D,stroke:#566573,stroke-width:2px,color:#fff
    classDef outcomeStyle fill:#95A5A6,stroke:#7F8C8D,stroke-width:2px,color:#fff
    
    class I1,I2,I3,I4 intakeStyle
    class T1,T2,T3,T4 triageStyle
    class F1,F2,F3,F4,F5 fulfilmentStyle
    class IV1,IV2,IV3,IV4 investigationStyle
    class E1,E2,E3,E4 escalationStyle
    class R1,R2,R3,R4,R5 riskStyle
    class SO1,SO2,SO3,SO4 supportOpsStyle
    class SP1,SP2,SP3,SP4 supportProcStyle
    class Complete,Hold,Resolve,Approved outcomeStyle
