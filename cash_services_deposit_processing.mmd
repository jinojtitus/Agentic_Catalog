%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#fff', 'primaryTextColor':'#333', 'lineColor':'#333'}}}%%
flowchart TB
    %% Cash Services - Deposit Processing Workflow
    
    %% Intake Subgraph
    subgraph INTAKE[INTAKE]
        direction TB
        I1[Customer Arrives with Deposit]
        I2[Verify Customer Identity]
        I3[Collect Deposit Items]
        I4[Issue Temporary Receipt]
        I5[Create Deposit Ticket]
        
        I1 --> I2
        I2 --> I3
        I3 --> I4
        I4 --> I5
    end
    
    %% Triage Subgraph
    subgraph TRIAGE[TRIAGE]
        direction TB
        T1{Assess Deposit Type}
        T2[Cash Deposits]
        T3[Check Deposits]
        T4[Wire Transfers]
        T5[Mixed Deposits]
        T6[Priority Classification]
        
        T1 -->|Cash Only| T2
        T1 -->|Checks Only| T3
        T1 -->|Electronic| T4
        T1 -->|Multiple Types| T5
        T2 --> T6
        T3 --> T6
        T4 --> T6
        T5 --> T6
    end
    
    %% Fulfillment Subgraph
    subgraph FULFILLMENT[FULFILLMENT]
        direction TB
        F1[Count and Verify Cash]
        F2[Scan Check Images]
        F3[Validate Wire Details]
        F4[Calculate Total Amount]
        F5[Post to Customer Account]
        F6[Generate Confirmation]
        F7[Send Notification]
        
        F1 --> F4
        F2 --> F4
        F3 --> F4
        F4 --> F5
        F5 --> F6
        F6 --> F7
    end
    
    %% Investigations Subgraph
    subgraph INVESTIGATIONS[INVESTIGATIONS]
        direction TB
        IV1{Discrepancy Detected?}
        IV2[Review Transaction Details]
        IV3[Check Documentation]
        IV4[Contact Customer]
        IV5[Analyze Patterns]
        IV6[Document Findings]
        IV7{Resolution Found?}
        
        IV1 -->|Yes| IV2
        IV2 --> IV3
        IV3 --> IV4
        IV4 --> IV5
        IV5 --> IV6
        IV6 --> IV7
    end
    
    %% Escalations Subgraph
    subgraph ESCALATIONS[ESCALATIONS]
        direction TB
        E1[Create Escalation Ticket]
        E2[Assign to Senior Staff]
        E3[Management Review]
        E4[Decision Making]
        E5[Implement Resolution]
        E6[Document Outcome]
        
        E1 --> E2
        E2 --> E3
        E3 --> E4
        E4 --> E5
        E5 --> E6
    end
    
    %% Risk Controls Subgraph
    subgraph RISK_CONTROLS[RISK CONTROLS]
        direction TB
        R1[AML Screening]
        R2[Fraud Detection]
        R3[Limit Checks]
        R4[Suspicious Activity Review]
        R5[Compliance Validation]
        R6{Risk Level}
        R7[File SAR if Required]
        
        R1 --> R6
        R2 --> R6
        R3 --> R6
        R4 --> R6
        R5 --> R6
        R6 -->|High Risk| R7
    end
    
    %% Support Operations Management Subgraph
    subgraph SUPPORT_OPS[SUPPORT - OPERATIONS MANAGEMENT]
        direction LR
        SO1[Staff Scheduling]
        SO2[Training Programs]
        SO3[Performance Monitoring]
        SO4[Resource Allocation]
        SO5[Quality Control]
        
        SO1 --> SO2
        SO2 --> SO3
        SO3 --> SO4
        SO4 --> SO5
    end
    
    %% Support Process Management Subgraph
    subgraph SUPPORT_PROCESS[SUPPORT - PROCESS MANAGEMENT]
        direction LR
        SP1[Policy Updates]
        SP2[Procedure Documentation]
        SP3[System Maintenance]
        SP4[Regulatory Compliance]
        SP5[Audit Management]
        
        SP1 --> SP2
        SP2 --> SP3
        SP3 --> SP4
        SP4 --> SP5
    end
    
    %% Main Flow Connections
    INTAKE --> TRIAGE
    TRIAGE --> RISK_CONTROLS
    RISK_CONTROLS --> FULFILLMENT
    FULFILLMENT --> INVESTIGATIONS
    INVESTIGATIONS -->|Issues Found| ESCALATIONS
    INVESTIGATIONS -->|No Issues| END_PROCESS[Process Complete]
    ESCALATIONS --> END_PROCESS
    
    %% Support Connections
    SUPPORT_OPS -.->|Enables| INTAKE
    SUPPORT_OPS -.->|Enables| FULFILLMENT
    SUPPORT_PROCESS -.->|Governs| RISK_CONTROLS
    SUPPORT_PROCESS -.->|Governs| INVESTIGATIONS
    
    %% Styling
    classDef intakeStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    classDef triageStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef fulfillmentStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    classDef investigationStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    classDef escalationStyle fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000
    classDef riskStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    classDef supportOpsStyle fill:#e0f2f1,stroke:#00796b,stroke-width:2px,color:#000
    classDef supportProcStyle fill:#f1f8e9,stroke:#558b2f,stroke-width:2px,color:#000
    classDef endStyle fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px,color:#000
    
    class INTAKE intakeStyle
    class TRIAGE triageStyle
    class FULFILLMENT fulfillmentStyle
    class INVESTIGATIONS investigationStyle
    class ESCALATIONS escalationStyle
    class RISK_CONTROLS riskStyle
    class SUPPORT_OPS supportOpsStyle
    class SUPPORT_PROCESS supportProcStyle
    class END_PROCESS endStyle