%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#2E86AB', 'primaryTextColor': '#fff', 'primaryBorderColor': '#1E5F8E', 'lineColor': '#5C677D', 'secondaryColor': '#A23B72', 'tertiaryColor': '#F18F01', 'background': '#C73E1D'}}}%%
flowchart TB
    %% Intake - Blue
    subgraph INTAKE["INTAKE"]
        direction TB
        I1[Deposit Request Received]
        I2[Customer Authentication]
        I3[Initial Validation]
        I4[Request Categorization]
        I1 --> I2
        I2 --> I3
        I3 --> I4
    end
    
    %% Triage - Purple
    subgraph TRIAGE["TRIAGE"]
        direction TB
        T1[Priority Assignment]
        T2[Risk Assessment]
        T3[Compliance Check]
        T4[Route to Processing]
        T1 --> T2
        T2 --> T3
        T3 --> T4
    end
    
    %% Fulfilment - Green
    subgraph FULFILMENT["FULFILMENT"]
        direction TB
        F1[Deposit Processing]
        F2[Fund Verification]
        F3[Account Credit]
        F4[Transaction Recording]
        F5[Confirmation Generation]
        F1 --> F2
        F2 --> F3
        F3 --> F4
        F4 --> F5
    end
    
    %% Investigations - Orange
    subgraph INVESTIGATIONS["INVESTIGATIONS"]
        direction TB
        IV1[Suspicious Activity Review]
        IV2[Document Verification]
        IV3[Source of Funds Check]
        IV4[Investigation Resolution]
        IV1 --> IV2
        IV2 --> IV3
        IV3 --> IV4
    end
    
    %% Escalations - Red
    subgraph ESCALATIONS["ESCALATIONS"]
        direction TB
        E1[Fraud Alert]
        E2[Compliance Escalation]
        E3[Management Approval]
        E4[Regulatory Notification]
        E1 --> E2
        E2 --> E3
        E3 --> E4
    end
    
    %% Risk Controls - Dark Blue
    subgraph RISK["RISK CONTROLS"]
        direction TB
        R1[AML Screening]
        R2[Sanctions Check]
        R3[Threshold Monitoring]
        R4[Pattern Analysis]
        R5[Audit Logging]
        R1 --> R2
        R2 --> R3
        R3 --> R4
        R4 --> R5
    end
    
    %% Support Operations - Teal
    subgraph SUPPORT_OPS["SUPPORT - OPERATIONS MANAGEMENT"]
        direction TB
        SO1[Queue Management]
        SO2[Resource Allocation]
        SO3[System Monitoring]
        SO4[Incident Management]
        SO1 --> SO2
        SO2 --> SO3
        SO3 --> SO4
    end
    
    %% Support Process - Gray
    subgraph SUPPORT_PROC["SUPPORT - PROCESS MANAGEMENT"]
        direction TB
        SP1[SOP Maintenance]
        SP2[KPI Tracking]
        SP3[Quality Assurance]
        SP4[Process Optimization]
        SP1 --> SP2
        SP2 --> SP3
        SP3 --> SP4
    end
    
    %% Main Flow Connections
    I4 --> T1
    T4 --> F1
    F5 --> Complete[Deposit Complete]
    
    %% Investigation Triggers
    T2 -.->|High Risk| IV1
    F2 -.->|Anomaly Detected| IV1
    
    %% Escalation Triggers
    IV4 -.->|Suspicious| E1
    R3 -.->|Threshold Breach| E2
    
    %% Risk Control Integration
    T3 -.->|Screening| R1
    F1 -.->|Monitoring| R3
    
    %% Support Integration
    T1 -.->|Queue| SO1
    F5 -.->|Metrics| SO3
    
    %% Process Support
    Complete -.->|KPI Update| SP2
    E4 -.->|Process Review| SP4
    
    %% Outcome Paths
    E4 --> Decline[Transaction Declined]
    IV4 --> Clear[Investigation Cleared]
    R5 --> Compliant[Compliance Confirmed]
    
    %% Styling
    classDef intakeStyle fill:#2E86AB,stroke:#1E5F8E,stroke-width:2px,color:#fff
    classDef triageStyle fill:#A23B72,stroke:#7D2E5A,stroke-width:2px,color:#fff
    classDef fulfilmentStyle fill:#27AE60,stroke:#1E8449,stroke-width:2px,color:#fff
    classDef investigationStyle fill:#F18F01,stroke:#C73E1D,stroke-width:2px,color:#fff
    classDef escalationStyle fill:#E74C3C,stroke:#C0392B,stroke-width:2px,color:#fff
    classDef riskStyle fill:#34495E,stroke:#2C3E50,stroke-width:2px,color:#fff
    classDef supportOpsStyle fill:#16A085,stroke:#138D75,stroke-width:2px,color:#fff
    classDef supportProcStyle fill:#7F8C8D,stroke:#566573,stroke-width:2px,color:#fff
    classDef outcomeStyle fill:#95A5A6,stroke:#7F8C8D,stroke-width:2px,color:#fff
    
    class I1,I2,I3,I4 intakeStyle
    class T1,T2,T3,T4 triageStyle
    class F1,F2,F3,F4,F5 fulfilmentStyle
    class IV1,IV2,IV3,IV4 investigationStyle
    class E1,E2,E3,E4 escalationStyle
    class R1,R2,R3,R4,R5 riskStyle
    class SO1,SO2,SO3,SO4 supportOpsStyle
    class SP1,SP2,SP3,SP4 supportProcStyle
    class Complete,Decline,Clear,Compliant outcomeStyle
